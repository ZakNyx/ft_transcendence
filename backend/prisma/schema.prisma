// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())

  email          String  @unique

  imageUrl       String
  picture        String?
  pictureStatus Boolean @default(false)
  pictureMimetype String?

  username    String @unique
  displayname String @unique
  status      Status @default(OFFLINE)

  wins  Int @default(0)
  loses Int @default(0)
  winrate Float @default(0)
  gamesPlayed Int @default(0)
  elo   Int @default(0)

  status2fa Boolean @default(false)
  validated  Boolean @default(false)

  secret2fa     String?
  secretAuthUrl String?

  friends User[] @relation("friends")
  friendOf User[] @relation("friends")
  blocks User[] @relation("blocked")
  blockedBy User[] @relation("blocked")
  requested User[] @relation("friendreq")
  requestedBy User[] @relation("friendreq")

  notifications Notification[]

  games Game[] @relation("GamePlayers")

  chatRooms ChatRoom[] @relation("userInChatRoom")
  messages  Message[]

}

model Notification {
  id Int @id @default(autoincrement())

  reciever String
  sender   String
  type String
  data String
  time DateTime @default(now())

  user User @relation(fields: [reciever], references: [username])
}

model ChatRoom {
  id         Int       @id @default(autoincrement())

  roomName   String    @unique
  timeCreate DateTime  @default(now())

  users      User[]    @relation("userInChatRoom")

  messages   Message[]

  admins     String[]
  mutedUsers  String[]
  bannedUsers   String[]

  isDm      Boolean   @default(false)

  status     String    @default("public")

  password   String?
}

model Game {
  id  Int   @default(autoincrement()) @id

  player1 String
  player2 String

  score1 Int @default(0)
  score2 Int @default(0)

  users User[] @relation("GamePlayers")
  ingame Boolean @default(false)
}

model Message {
  id       Int      @id @default(autoincrement())

  data     String
  time     String
  roomId   Int
  userId   Int

  user     User     @relation(fields: [userId], references: [id])
  roomData ChatRoom @relation(fields: [roomId], references: [id])
}

enum Status {
  ONLINE
  OFFLINE
  INGAME
}
